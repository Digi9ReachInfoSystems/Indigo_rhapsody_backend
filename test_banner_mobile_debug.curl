#!/bin/bash

echo "üîç Banner Mobile Debug - Troubleshooting Script"
echo "==============================================="
echo ""

BASE_URL="http://localhost:5000"

echo "üìã Step 1: Check ALL Banners (Debug Endpoint)"
echo "GET ${BASE_URL}/banner/debug/all"
echo ""
curl -X GET "${BASE_URL}/banner/debug/all" \
  -H "Content-Type: application/json" | jq '.'
echo ""
echo "üëÜ CHECK THE OUTPUT ABOVE:"
echo "   - Look at 'mobile.count' - this shows total mobile banners"
echo "   - Look at 'mobile.banners' - this shows all mobile banner details"
echo "   - Verify 'platform' field is 'mobile' or 'both'"
echo "   - Verify 'isActive' is true"
echo ""
echo "-------------------------------------------------------------------"
echo ""

echo "üìã Step 2: Get Mobile Banners via Platform Endpoint"
echo "GET ${BASE_URL}/banner/platform/mobile"
echo ""
curl -X GET "${BASE_URL}/banner/platform/mobile" \
  -H "Content-Type: application/json" | jq '.'
echo ""
echo "üëÜ CHECK THE OUTPUT:"
echo "   - Look at 'count' field"
echo "   - Look at 'pagination.total' field"
echo "   - Check if 'hasMore' is true (means more banners available)"
echo ""
echo "-------------------------------------------------------------------"
echo ""

echo "üìã Step 3: Get Mobile Banners for Home Page"
echo "GET ${BASE_URL}/banner/page/home?platform=mobile"
echo ""
curl -X GET "${BASE_URL}/banner/page/home?platform=mobile" \
  -H "Content-Type: application/json" | jq '.'
echo ""
echo "üëÜ CHECK THE OUTPUT:"
echo "   - Look at 'count' field"
echo "   - Verify banners have correct 'page' value"
echo ""
echo "-------------------------------------------------------------------"
echo ""

echo "üìã Step 4: Get All Banners (No Filters)"
echo "GET ${BASE_URL}/banner"
echo ""
curl -X GET "${BASE_URL}/banner" \
  -H "Content-Type: application/json" | jq '.' | head -100
echo ""
echo "-------------------------------------------------------------------"
echo ""

echo "üìã Step 5: Get Mobile Banners with Inactive Included"
echo "GET ${BASE_URL}/banner/platform/mobile?isActive=false"
echo ""
curl -X GET "${BASE_URL}/banner/platform/mobile?isActive=false" \
  -H "Content-Type: application/json" | jq '.'
echo ""
echo "üëÜ This shows INACTIVE mobile banners (if any)"
echo ""
echo "-------------------------------------------------------------------"
echo ""

echo ""
echo "üí° Troubleshooting Checklist:"
echo "============================="
echo ""
echo "If you're only seeing 2 banners, check:"
echo ""
echo "1Ô∏è‚É£  Platform Field:"
echo "   - Verify banners have platform: 'mobile' or 'both'"
echo "   - Not 'web' only"
echo ""
echo "2Ô∏è‚É£  Active Status:"
echo "   - Verify isActive: true"
echo "   - Check Step 5 output for inactive banners"
echo ""
echo "3Ô∏è‚É£  Date Scheduling:"
echo "   - Check startDate (should be null or in past)"
echo "   - Check endDate (should be null or in future)"
echo "   - Expired banners won't show"
echo ""
echo "4Ô∏è‚É£  Page Assignment:"
echo "   - If using /banner/page/:pageName endpoint"
echo "   - Verify banner.page matches the page you're querying"
echo ""
echo "5Ô∏è‚É£  Display Order:"
echo "   - All banners should have unique displayOrder"
echo "   - Check for duplicates"
echo ""
echo "üîß Quick Fixes:"
echo "==============="
echo ""
echo "Fix 1: Activate a banner"
echo "  curl -X PATCH 'http://localhost:5000/banner/BANNER_ID/toggle' \\"
echo "    -H 'Authorization: Bearer ADMIN_TOKEN'"
echo ""
echo "Fix 2: Update banner to mobile platform"
echo "  curl -X PUT 'http://localhost:5000/banner/BANNER_ID' \\"
echo "    -H 'Authorization: Bearer ADMIN_TOKEN' \\"
echo "    -d '{\"platform\": \"mobile\"}'"
echo ""
echo "Fix 3: Remove date restrictions"
echo "  curl -X PUT 'http://localhost:5000/banner/BANNER_ID' \\"
echo "    -H 'Authorization: Bearer ADMIN_TOKEN' \\"
echo "    -d '{\"startDate\": null, \"endDate\": null}'"
echo ""
echo "üìä Server Logs:"
echo "==============="
echo "Check your server console for these messages:"
echo "  üîç Fetching banners for platform: mobile"
echo "  Filter: { ... }"
echo "  ‚úÖ Found X banners"
echo ""
echo "If 'Found X banners' shows only 2, then:"
echo "  - Only 2 banners match the filters in database"
echo "  - Check the debug endpoint to see all banners"
echo "  - Update banners that should be mobile but aren't"
echo ""

