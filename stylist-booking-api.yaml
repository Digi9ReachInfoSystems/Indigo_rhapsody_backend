openapi: 3.0.3
info:
  title: Stylist Booking System API
  description: Comprehensive booking system for stylists with calendar management, Razorpay payments, Agora video calls, and chat functionality
  version: 1.0.0
  contact:
    name: API Support
    email: support@indigorhapsody.com
servers:
  - url: http://localhost:3000/api/stylist-booking
    description: Development server
  - url: https://api.indigorhapsody.com/api/stylist-booking
    description: Production server

paths:
  /available-slots/{stylistId}:
    get:
      summary: Get available time slots for a stylist
      description: Retrieve available booking slots for a specific stylist on a given date
      tags:
        - Booking Management
      parameters:
        - name: stylistId
          in: path
          required: true
          description: Unique identifier of the stylist
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
            example: "507f1f77bcf86cd799439011"
        - name: date
          in: query
          required: true
          description: Date to check availability (YYYY-MM-DD format)
          schema:
            type: string
            format: date
            example: "2023-12-25"
        - name: duration
          in: query
          description: Duration of the booking in minutes
          schema:
            type: integer
            minimum: 30
            maximum: 240
            default: 60
            example: 60
      responses:
        '200':
          description: Available slots retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvailableSlotsResponse'
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Stylist not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /create:
    post:
      summary: Create a new booking
      description: Create a new stylist booking with payment processing
      tags:
        - Booking Management
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBookingRequest'
            example:
              stylistId: "507f1f77bcf86cd799439011"
              bookingType: "consultation"
              bookingTitle: "Hair Styling Consultation"
              bookingDescription: "Looking for advice on a new hairstyle"
              scheduledDate: "2023-12-25"
              scheduledTime: "14:00"
              duration: 60
      responses:
        '201':
          description: Booking created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateBookingResponse'
        '400':
          description: Bad request - validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /payment/initiate/{bookingId}:
    post:
      summary: Initiate payment for booking
      description: Initiate Razorpay payment for a booking
      tags:
        - Payment
      security:
        - bearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          description: Unique identifier of the booking
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
            example: "507f1f77bcf86cd799439011"
      responses:
        '200':
          description: Payment initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentInitiationResponse'
        '400':
          description: Bad request - invalid booking ID or booking not in correct status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - booking does not belong to user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Booking not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /payment/callback:
    post:
      summary: Handle payment callback
      description: Handle Razorpay payment callback and confirm booking
      tags:
        - Payment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentCallbackRequest'
      responses:
        '200':
          description: Payment callback processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentCallbackResponse'
        '400':
          description: Bad request - invalid payment signature
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Booking not found for payment
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user-bookings:
    get:
      summary: Get user's bookings
      description: Retrieve all bookings for the authenticated user
      tags:
        - User Bookings
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of bookings per page
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
        - name: status
          in: query
          description: Filter by booking status
          schema:
            type: string
            enum: [pending, confirmed, in_progress, completed, cancelled, rescheduled, no_show]
      responses:
        '200':
          description: User bookings retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBookingsResponse'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /stylist-bookings:
    get:
      summary: Get stylist's bookings
      description: Retrieve all bookings for the authenticated stylist
      tags:
        - Stylist Bookings
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of bookings per page
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
        - name: status
          in: query
          description: Filter by booking status
          schema:
            type: string
            enum: [pending, confirmed, in_progress, completed, cancelled, rescheduled, no_show]
      responses:
        '200':
          description: Stylist bookings retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StylistBookingsResponse'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - stylist role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /start-video-call/{bookingId}:
    post:
      summary: Start video call
      description: Initiate Agora video call for a confirmed booking
      tags:
        - Video Calls
      security:
        - bearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          description: Unique identifier of the booking
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
            example: "507f1f77bcf86cd799439011"
      responses:
        '200':
          description: Video call initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoCallResponse'
        '400':
          description: Bad request - booking not in correct status or not time for call
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - user not authorized for this booking
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Booking not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /end-video-call/{bookingId}:
    post:
      summary: End video call
      description: End the ongoing video call and mark booking as completed
      tags:
        - Video Calls
      security:
        - bearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          description: Unique identifier of the booking
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
            example: "507f1f77bcf86cd799439011"
      responses:
        '200':
          description: Video call ended successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EndVideoCallResponse'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - user not authorized for this booking
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Booking not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reschedule/{bookingId}:
    post:
      summary: Reschedule booking
      description: Reschedule a confirmed booking to a new date and time
      tags:
        - Booking Management
      security:
        - bearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          description: Unique identifier of the booking
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
            example: "507f1f77bcf86cd799439011"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RescheduleBookingRequest'
      responses:
        '200':
          description: Booking rescheduled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RescheduleBookingResponse'
        '400':
          description: Bad request - booking cannot be rescheduled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - booking does not belong to user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Booking not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /cancel/{bookingId}:
    post:
      summary: Cancel booking
      description: Cancel a confirmed booking and process refund if applicable
      tags:
        - Booking Management
      security:
        - bearerAuth: []
      parameters:
        - name: bookingId
          in: path
          required: true
          description: Unique identifier of the booking
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
            example: "507f1f77bcf86cd799439011"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelBookingRequest'
      responses:
        '200':
          description: Booking cancelled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelBookingResponse'
        '400':
          description: Bad request - booking cannot be cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - booking does not belong to user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Booking not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    CreateBookingRequest:
      type: object
      required:
        - stylistId
        - bookingTitle
        - bookingDescription
        - scheduledDate
        - scheduledTime
      properties:
        stylistId:
          type: string
          pattern: '^[0-9a-fA-F]{24}$'
          description: Unique identifier of the stylist
          example: "507f1f77bcf86cd799439011"
        bookingType:
          type: string
          enum: [consultation, styling_session, makeover, custom]
          default: consultation
          description: Type of booking
          example: "consultation"
        bookingTitle:
          type: string
          description: Title of the booking
          example: "Hair Styling Consultation"
        bookingDescription:
          type: string
          description: Detailed description of the booking
          example: "Looking for advice on a new hairstyle for my wedding"
        scheduledDate:
          type: string
          format: date
          description: Scheduled date for the booking
          example: "2023-12-25"
        scheduledTime:
          type: string
          pattern: '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
          description: Scheduled time in HH:MM format
          example: "14:00"
        duration:
          type: integer
          minimum: 30
          maximum: 240
          default: 60
          description: Duration of the booking in minutes
          example: 60

    CreateBookingResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Booking created successfully. Please complete payment to confirm."
        data:
          type: object
          properties:
            bookingId:
              type: string
              example: "507f1f77bcf86cd799439011"
            bookingType:
              type: string
              example: "consultation"
            scheduledDate:
              type: string
              format: date
              example: "2023-12-25"
            scheduledTime:
              type: string
              example: "14:00"
            duration:
              type: integer
              example: 60
            paymentAmount:
              type: number
              example: 1000
            status:
              type: string
              enum: [pending]
              example: "pending"
            nextStep:
              type: string
              example: "payment"

    AvailableSlotsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Available slots retrieved successfully"
        data:
          type: object
          properties:
            stylistId:
              type: string
              example: "507f1f77bcf86cd799439011"
            date:
              type: string
              format: date
              example: "2023-12-25"
            duration:
              type: integer
              example: 60
            availableSlots:
              type: array
              items:
                type: object
                properties:
                  time:
                    type: string
                    example: "14:00"
                  datetime:
                    type: string
                    format: date-time
                    example: "2023-12-25T14:00:00Z"
                  duration:
                    type: integer
                    example: 60
            totalSlots:
              type: integer
              example: 8

    PaymentInitiationResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Payment initiated successfully"
        data:
          type: object
          properties:
            bookingId:
              type: string
              example: "507f1f77bcf86cd799439011"
            orderId:
              type: string
              example: "order_123456789"
            amount:
              type: number
              example: 1000
            currency:
              type: string
              example: "INR"
            paymentOptions:
              type: object
              description: Razorpay payment options for client-side integration
            expiresIn:
              type: integer
              example: 1800

    PaymentCallbackRequest:
      type: object
      required:
        - razorpay_order_id
        - razorpay_payment_id
        - razorpay_signature
      properties:
        razorpay_order_id:
          type: string
          description: Razorpay order ID
          example: "order_123456789"
        razorpay_payment_id:
          type: string
          description: Razorpay payment ID
          example: "pay_123456789"
        razorpay_signature:
          type: string
          description: Razorpay payment signature
          example: "signature_123456789"

    PaymentCallbackResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Payment completed successfully. Booking confirmed."
        data:
          type: object
          properties:
            bookingId:
              type: string
              example: "507f1f77bcf86cd799439011"
            paymentStatus:
              type: string
              enum: [completed]
              example: "completed"
            bookingStatus:
              type: string
              enum: [confirmed]
              example: "confirmed"
            paymentId:
              type: string
              example: "pay_123456789"

    UserBookingsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "User bookings retrieved successfully"
        data:
          type: object
          properties:
            bookings:
              type: array
              items:
                $ref: '#/components/schemas/Booking'
            pagination:
              $ref: '#/components/schemas/PaginationInfo'

    StylistBookingsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Stylist bookings retrieved successfully"
        data:
          type: object
          properties:
            bookings:
              type: array
              items:
                $ref: '#/components/schemas/Booking'
            pagination:
              $ref: '#/components/schemas/PaginationInfo'

    Booking:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        bookingId:
          type: string
          example: "BOOK_1703123456789_abc123def"
        userId:
          type: string
          example: "507f1f77bcf86cd799439012"
        stylistId:
          type: string
          example: "507f1f77bcf86cd799439013"
        bookingType:
          type: string
          enum: [consultation, styling_session, makeover, custom]
          example: "consultation"
        bookingTitle:
          type: string
          example: "Hair Styling Consultation"
        bookingDescription:
          type: string
          example: "Looking for advice on a new hairstyle"
        scheduledDate:
          type: string
          format: date
          example: "2023-12-25"
        scheduledTime:
          type: string
          example: "14:00"
        duration:
          type: integer
          example: 60
        status:
          type: string
          enum: [pending, confirmed, in_progress, completed, cancelled, rescheduled, no_show]
          example: "confirmed"
        paymentStatus:
          type: string
          enum: [pending, processing, completed, failed, refunded, partially_refunded]
          example: "completed"
        paymentAmount:
          type: number
          example: 1000
        videoCallStatus:
          type: string
          enum: [not_started, initiated, in_progress, ended, failed]
          example: "not_started"
        createdAt:
          type: string
          format: date-time
          example: "2023-12-21T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-12-21T10:30:00Z"

    VideoCallResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Video call initiated successfully"
        data:
          type: object
          properties:
            bookingId:
              type: string
              example: "507f1f77bcf86cd799439011"
            channelName:
              type: string
              example: "booking_507f1f77bcf86cd799439011_507f1f77bcf86cd799439012_507f1f77bcf86cd799439013"
            appId:
              type: string
              example: "your_agora_app_id"
            rtcToken:
              type: string
              example: "agora_rtc_token"
            rtmToken:
              type: string
              example: "agora_rtm_token"
            uid:
              type: string
              example: "507f1f77bcf86cd799439011"
            expirationTime:
              type: integer
              example: 1703123456
            expiresIn:
              type: integer
              example: 3600

    EndVideoCallResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Video call ended successfully"
        data:
          type: object
          properties:
            bookingId:
              type: string
              example: "507f1f77bcf86cd799439011"
            callDuration:
              type: integer
              example: 45
            endedAt:
              type: string
              format: date-time
              example: "2023-12-25T15:00:00Z"

    RescheduleBookingRequest:
      type: object
      required:
        - newDate
        - newTime
        - reason
      properties:
        newDate:
          type: string
          format: date
          description: New scheduled date
          example: "2023-12-26"
        newTime:
          type: string
          pattern: '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
          description: New scheduled time in HH:MM format
          example: "15:00"
        reason:
          type: string
          description: Reason for rescheduling
          example: "Unexpected work meeting"

    RescheduleBookingResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Booking rescheduled successfully"
        data:
          type: object
          properties:
            originalBookingId:
              type: string
              example: "507f1f77bcf86cd799439011"
            rescheduledBookingId:
              type: string
              example: "507f1f77bcf86cd799439012"
            newDate:
              type: string
              format: date
              example: "2023-12-26"
            newTime:
              type: string
              example: "15:00"
            reason:
              type: string
              example: "Unexpected work meeting"

    CancelBookingRequest:
      type: object
      required:
        - reason
      properties:
        reason:
          type: string
          description: Reason for cancellation
          example: "Change of plans"

    CancelBookingResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Booking cancelled successfully"
        data:
          type: object
          properties:
            bookingId:
              type: string
              example: "507f1f77bcf86cd799439011"
            status:
              type: string
              enum: [cancelled]
              example: "cancelled"
            cancelledAt:
              type: string
              format: date-time
              example: "2023-12-21T11:00:00Z"
            reason:
              type: string
              example: "Change of plans"

    PaginationInfo:
      type: object
      properties:
        currentPage:
          type: integer
          example: 1
        totalPages:
          type: integer
          example: 5
        totalBookings:
          type: integer
          example: 47
        hasNextPage:
          type: boolean
          example: true
        hasPrevPage:
          type: boolean
          example: false

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          description: Error message
          example: "Invalid booking ID format"
        error:
          type: string
          description: Detailed error information (optional)
          example: "Validation failed for field 'stylistId'"

tags:
  - name: Booking Management
    description: Operations for creating and managing bookings
  - name: Payment
    description: Payment processing operations
  - name: User Bookings
    description: User-specific booking operations
  - name: Stylist Bookings
    description: Stylist-specific booking operations
  - name: Video Calls
    description: Video call operations using Agora
