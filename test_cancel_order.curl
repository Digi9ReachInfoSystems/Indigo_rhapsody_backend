# Test Cancel Order Endpoints
# This file tests the order cancellation functionality

# Base URL - Update this to match your server URL
BASE_URL="http://localhost:3000"

# Tokens - Replace with your actual tokens
USER_TOKEN="your_user_jwt_token_here"
ADMIN_TOKEN="your_admin_jwt_token_here"

echo "üß™ Testing Cancel Order Endpoints"
echo "================================"
echo ""

# Test 1: Get cancellation reasons
echo "‚úÖ Test 1: Get cancellation reasons"
echo "----------------------------------"
curl -X GET "${BASE_URL}/api/orders/cancellation-reasons" \
  -H "Content-Type: application/json" \
  -w "\n\nHTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
  -s
echo ""

# Test 2: User cancels their own order
echo "‚úÖ Test 2: User cancels their own order"
echo "-------------------------------------"
curl -X POST "${BASE_URL}/api/orders/cancel/ORDER_ID_HERE" \
  -H "Authorization: Bearer ${USER_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "reason": "Changed my mind",
    "cancelBy": "user"
  }' \
  -w "\n\nHTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
  -s
echo ""

# Test 3: Admin cancels any order
echo "‚úÖ Test 3: Admin cancels any order"
echo "--------------------------------"
curl -X POST "${BASE_URL}/api/orders/admin/cancel/ORDER_ID_HERE" \
  -H "Authorization: Bearer ${ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "reason": "Product out of stock",
    "cancelBy": "admin"
  }' \
  -w "\n\nHTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
  -s
echo ""

# Test 4: Cancel order without reason
echo "‚úÖ Test 4: Cancel order without reason"
echo "------------------------------------"
curl -X POST "${BASE_URL}/api/orders/cancel/ORDER_ID_HERE" \
  -H "Authorization: Bearer ${USER_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "cancelBy": "user"
  }' \
  -w "\n\nHTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
  -s
echo ""

# Test 5: Cancel order without authentication
echo "‚úÖ Test 5: Cancel order without authentication"
echo "--------------------------------------------"
curl -X POST "${BASE_URL}/api/orders/cancel/ORDER_ID_HERE" \
  -H "Content-Type: application/json" \
  -d '{
    "reason": "Changed my mind",
    "cancelBy": "user"
  }' \
  -w "\n\nHTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
  -s
echo ""

# Test 6: Cancel order with invalid order ID
echo "‚úÖ Test 6: Cancel order with invalid order ID"
echo "-------------------------------------------"
curl -X POST "${BASE_URL}/api/orders/cancel/invalid_order_id" \
  -H "Authorization: Bearer ${USER_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "reason": "Changed my mind",
    "cancelBy": "user"
  }' \
  -w "\n\nHTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
  -s
echo ""

# Test 7: Cancel non-existent order
echo "‚úÖ Test 7: Cancel non-existent order"
echo "----------------------------------"
curl -X POST "${BASE_URL}/api/orders/cancel/507f1f77bcf86cd799439011" \
  -H "Authorization: Bearer ${USER_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "reason": "Changed my mind",
    "cancelBy": "user"
  }' \
  -w "\n\nHTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
  -s
echo ""

# Test 8: Cancel order with invalid token
echo "‚úÖ Test 8: Cancel order with invalid token"
echo "----------------------------------------"
curl -X POST "${BASE_URL}/api/orders/cancel/ORDER_ID_HERE" \
  -H "Authorization: Bearer invalid_token" \
  -H "Content-Type: application/json" \
  -d '{
    "reason": "Changed my mind",
    "cancelBy": "user"
  }' \
  -w "\n\nHTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
  -s
echo ""

# Test 9: User tries to cancel order via admin endpoint
echo "‚úÖ Test 9: User tries to cancel order via admin endpoint"
echo "-----------------------------------------------------"
curl -X POST "${BASE_URL}/api/orders/admin/cancel/ORDER_ID_HERE" \
  -H "Authorization: Bearer ${USER_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "reason": "Changed my mind",
    "cancelBy": "user"
  }' \
  -w "\n\nHTTP Status: %{http_code}\nResponse Time: %{time_total}s\n" \
  -s
echo ""

echo "üéØ Test Summary:"
echo "================"
echo "‚úÖ Test 1: Should return list of cancellation reasons"
echo "‚úÖ Test 2: Should allow user to cancel their own order"
echo "‚úÖ Test 3: Should allow admin to cancel any order"
echo "‚úÖ Test 4: Should allow cancellation without reason"
echo "‚úÖ Test 5: Should return unauthorized error"
echo "‚úÖ Test 6: Should return invalid order ID error"
echo "‚úÖ Test 7: Should return order not found error"
echo "‚úÖ Test 8: Should return invalid token error"
echo "‚úÖ Test 9: Should return forbidden error for non-admin"
echo ""
echo "üìù Endpoint Details:"
echo "==================="
echo "‚Ä¢ GET /api/orders/cancellation-reasons - Get list of cancellation reasons"
echo "‚Ä¢ POST /api/orders/cancel/:orderId - User cancels their own order"
echo "‚Ä¢ POST /api/orders/admin/cancel/:orderId - Admin cancels any order"
echo ""
echo "üìä Request Body Parameters:"
echo "=========================="
echo "‚Ä¢ reason (optional): Cancellation reason"
echo "‚Ä¢ cancelBy (optional): Who cancelled the order (user, admin, system)"
echo ""
echo "üìä Response Structure:"
echo "====================="
echo "‚Ä¢ success: Boolean indicating success"
echo "‚Ä¢ message: Response message"
echo "‚Ä¢ data.orderId: Order ID"
echo "‚Ä¢ data.status: Updated order status"
echo "‚Ä¢ data.cancelledAt: Cancellation timestamp"
echo "‚Ä¢ data.cancellationReason: Reason for cancellation"
echo "‚Ä¢ data.cancelledBy: Who cancelled the order"
echo "‚Ä¢ data.refundRequired: Whether refund is needed"
echo ""
echo "üîí Cancellation Rules:"
echo "====================="
echo "‚Ä¢ Only orders with status 'Order Placed' or 'Processing' can be cancelled"
echo "‚Ä¢ Orders with completed payment cannot be cancelled via API"
echo "‚Ä¢ Product stock is automatically restored upon cancellation"
echo "‚Ä¢ Email and push notifications are sent to user"
echo "‚Ä¢ Admin can cancel any order regardless of status"
echo ""
echo "üí° Usage Examples:"
echo "=================="
echo "‚Ä¢ User cancellation: POST /api/orders/cancel/ORDER_ID -H 'Authorization: Bearer USER_TOKEN'"
echo "‚Ä¢ Admin cancellation: POST /api/orders/admin/cancel/ORDER_ID -H 'Authorization: Bearer ADMIN_TOKEN'"
echo "‚Ä¢ Get reasons: GET /api/orders/cancellation-reasons"
echo ""
echo "üìã Sample Request Body:"
echo "======================"
echo '{
  "reason": "Changed my mind",
  "cancelBy": "user"
}'
